// Gebetszeiten für PLZ oder Standort abrufen
document.getElementById("fetchTimes").addEventListener("click", function() {
    const postalCode = document.getElementById("postalCode").value;
    if (postalCode.length === 5) {
        fetchPrayerTimes(postalCode);
    } else {
        alert("Bitte gib eine gültige PLZ ein.");
    }
});

// Standortbasiertes Abrufen der Gebetszeiten
document.getElementById("useLocation").addEventListener("click", function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const { latitude, longitude } = position.coords;
            fetchPrayerTimesByLocation(latitude, longitude);
        }, () => {
            alert("Standortzugriff wurde verweigert.");
        });
    } else {
        alert("Dein Browser unterstützt keine Geolocation.");
    }
});

// Daten basierend auf PLZ abrufen
function fetchPrayerTimes(postalCode) {
    fetch(`https://api.pray.zone/v2/times/today.json?city=${postalCode}&method=2`)
        .then(response => response.json())
        .then(data => displayPrayerTimes(data.results.datetime[0].times))
        .catch(error => console.error("Fehler beim Abrufen der Daten:", error));
}

// Daten basierend auf Geolocation abrufen
function fetchPrayerTimesByLocation(lat, lng) {
    fetch(`https://api.pray.zone/v2/times/today.json?latitude=${lat}&longitude=${lng}&method=2`)
        .then(response => response.json())
        .then(data => displayPrayerTimes(data.results.datetime[0].times))
        .catch(error => console.error("Fehler beim Abrufen der Daten:", error));
}

// Gebetszeiten anzeigen
function displayPrayerTimes(times) {
    const list = document.getElementById("timesList");
    list.innerHTML = ""; // Liste leeren
    for (const [prayer, time] of Object.entries(times)) {
        const listItem = document.createElement("li");
        listItem.textContent = `${prayer}: ${time}`;
        list.appendChild(listItem);
    }
}
